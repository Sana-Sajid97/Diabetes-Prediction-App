# -*- coding: utf-8 -*-
"""diabetes_model.pkl.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BuU3JtZ1FAWXzBwoGlyia9_IEFE3ut9Y
"""

from google.colab import files
import pandas as pd

# Upload CSV manually
uploaded = files.upload()  # Click "Choose Files" and select diabetes.csv

# Load the uploaded CSV
data = pd.read_csv(list(uploaded.keys())[0])
print(data.head())

# Columns to fix
cols = ['Glucose','BloodPressure','SkinThickness','Insulin','BMI']

# Replace 0 with median
for col in cols:
    data[col] = data[col].replace(0, data[col].median())

# Check data
print(data.head())

# Features (everything except Outcome)
X = data.drop('Outcome', axis=1)

# Target
y = data['Outcome']

from sklearn.model_selection import train_test_split

# 80% training, 20% testing
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix

# Create model
model = RandomForestClassifier(n_estimators=100, random_state=42)

# Train the model
model.fit(X_train, y_train)

# Make predictions
y_pred = model.predict(X_test)

# Accuracy
print("Accuracy:", accuracy_score(y_test, y_pred))

# Confusion Matrix
print(confusion_matrix(y_test, y_pred))

!pip install streamlit
!pip install pyngrok

import pickle
with open("diabetes_model.pkl", "wb") as file:
    pickle.dump(model, file)

# Commented out IPython magic to ensure Python compatibility.
# %%writefile app.py
# import streamlit as st
# import pickle
# import numpy as np
# 
# model = pickle.load(open("diabetes_model.pkl", "rb"))
# st.title("Diabetes Risk Predictor")
# st.write("Enter your health metrics:")
# 
# pregnancies = st.number_input("Pregnancies", 0, 20, 0)
# glucose = st.number_input("Glucose", 0, 200, 100)
# bp = st.number_input("Blood Pressure", 0, 140, 70)
# skin = st.number_input("Skin Thickness", 0, 100, 20)
# insulin = st.number_input("Insulin", 0, 900, 80)
# bmi = st.number_input("BMI", 0.0, 70.0, 25.0)
# dpf = st.number_input("Diabetes Pedigree Function", 0.0, 3.0, 0.5)
# age = st.number_input("Age", 0, 120, 30)
# 
# if st.button("Predict"):
#     features = np.array([[pregnancies, glucose, bp, skin, insulin, bmi, dpf, age]])
#     prediction = model.predict(features)
#     if prediction[0] == 1:
#         st.error("High Risk of Diabetes")
#     else:
#         st.success("Low Risk of Diabetes")
#

from google.colab import files
uploaded = files.upload()

from google.colab import files
uploaded = files.upload()

import os
import time

# Start Streamlit app
os.system("streamlit run app.py &")
time.sleep(5)

# Get shareable link
!lt --port 8501 --subdomain myhackathondemo
